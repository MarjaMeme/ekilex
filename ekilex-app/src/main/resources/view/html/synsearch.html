<!DOCTYPE html>
<html lang="et" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="common :: common_header(~{::title},~{::links})">
<title th:text="#{syn.search.title}">EKILEX otsing</title>
<th:block th:fragment="links">
</th:block>
</head>
<body class="d-flex flex-column">
  <th:block th:replace="common :: nav_bar(activeItem = 'syn')"></th:block>
  <div class="card shadow rounded-0 border-0 flex-shrink-0">
    <div class="card-body px-2 py-3">
      <form th:action="@{/synsearch}" method="post">
        <th:block th:replace="search :: search_form('lex_search', false)"></th:block>
      </form>
    </div>
  </div>
  <div class="container-fluid flex-grow-1 flex-shrink-1 d-flex flex-column h-100 overflow-hidden" th:with="isSearchResult = ${wordsResult != null}">
    <div class="mt-4 float-left" th:if="${invalidSearch}">
      <div th:text="#{lex.search.invalid}"></div>
    </div>
    <div class="row no-gutters py-3 flex-grow-1 h-100">
      <div class="col-3 pr-2 h-100" th:if="${isSearchResult}">
        <div class="mt-4 float-left" th:if="${noResults == true}">
          <div th:text="#{common.not.found}">Not found.</div>
        </div>
        <div id="synSearchResultsDiv" class="card shadow navigate-panel h-100 d-flex flex-column" th:if="${not #lists.isEmpty(wordsResult.words)}">
          <div th:replace="syncomp :: search_result"></div>
        </div>
      </div>
      <div class="col-9 h-100 d-flex flex-column">
        <div id="syn-details-area"></div>
      </div>
    </div>
  </div>
  <th:block th:fragment="details" th:if="${details != null}">
    <div th:data-id="${wordId}" id="syn-details-area" class="h-100">
      <button id="refresh-details" hidden th:data-id="${wordId}" name="synDetailsBtn" data-refresh></button>
      <div class="navigate-panel card shadow h-100">
        <div class="card-body p-0 d-flex flex-column h-100">
          <div class="px-2 d-flex flex-row align-items-center py-2">
            <h1 th:utext="${viewUtil.getWordValueMarkup(details.word)}" class="mr-3 mb-0">Aktiivne sõna</h1>
            <button type="button" class="btn btn-secondary btn-compact"
                    id="activeTagCompleteBtn"
                    th:data-word-id="${wordId}"
                    th:disabled="${details.activeTagComplete}"
                    th:if="${userRoleData.lexemeActiveTagChangeEnabled}"
                    sec:authorize="#vars.details.word.subGrant">Märgi tehtuks
            </button>
            <button type="button" class="btn px-2 rounded-0" data-toggle="modal" data-target="#selectSynMeaningWordLangDlg">
              <span th:title="#{syn.choose.meaning.word.languages}" data-toggle="tooltip">
                <i class="action-icon fa fa-globe" aria-hidden="true"></i>
              </span>
            </button>
            <div th:replace="syncomp :: syn_logdata"></div>
          </div>
          <div class="row no-gutters h-100 overflow-hidden">
            <div class="col-8 overflow-auto h-100 keyboard-nav-list lexeme-list" data-panel-index="2" th:attrappend="data-marked-word-id=${markedSynWordId != null}?${markedSynWordId}">
              <div class="border-bottom pb-2">
                <div class="col-12">
                  <div>
                    <span class="lbl">Keelendi märkused</span>
                    <button type="button" class="btn btn-light badge"
                            title="Lisa uus" data-toggle="modal"
                            th:data-target="${'#addWordNoteDlg_' + wordId}"
                            sec:authorize="#vars.details.word.crudGrant">
                      <i class="action-icon fa fa-plus" aria-hidden="true"></i>
                    </button>
                  </div>
                  <div th:each="note : ${details.word.notes}">
                    <div th:replace="syndialog :: edit_word_note_dlg"></div>
                    <div class="col hidden-buttons pr-5">
                      <div class="action-buttons-anchor">
                        <span th:utext="${note.valuePrese}"></span>
                        <span class="ctxt" th:text="'[' + ${note.modifiedBy} + ']'" th:if="${note.modifiedBy != null}"></span>
                        <span class="ctxt" th:text="'(' + #{'boolean.public.' + ${note.public}} + ')'" th:if="${details.word.crudGrant}"></span>
                        <div class="action-buttons-2">
                          <button type="button" class="btn badge badge-primary"
                                  title="Muuda"
                                  data-toggle="modal"
                                  th:data-target="${'#editWordNoteDlg_' + note.id}"
                                  sec:authorize="#vars.details.word.crudGrant">
                            <i class="fa fa-edit" aria-hidden="true"></i>
                          </button>
                          <button type="button" class="btn badge badge-warning"
                                  th:data-id="${note.id}"
                                  data-op-code="word_note"
                                  data-toggle="delete-confirm"
                                  data-placement="right"
                                  sec:authorize="#vars.details.word.crudGrant">
                            <i class="fa fa-remove" aria-hidden="true"></i>
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="px-3 droppable-lexeme border-bottom border-light lexeme-list-item"
                   th:each="lexeme, lexemeIter : ${details.lexemes}"
                   th:classappend="${lexemeIter.first} ? 'pb-2' : 'py-2'"
                   th:data-meaning-id="${lexeme.meaningId}"
                   th:data-lexeme-id="${lexeme.lexemeId}"
                   th:data-navigate-index="${lexemeIter.index}">
                <th:block th:replace="syndialog :: add_lexeme_tag_dlg"></th:block>
                <div data-lexeme-title class="lexeme-inner" th:classappend="${lexeme.levels != null && lexeme.levels.length() > 2} ? 'pl-4': ''">
                  <div class="d-flex align-items-start flex-wrap pt-2">
                    <span class="px-2 py-0 bg-light rounded font-weight-bold mr-2">
                      <span th:if="${lexeme.levels != null}" th:text="${lexeme.levels}"> 1</span>
                    </span>
                    <th:block th:replace="syncomp :: pos_data"></th:block>
                    <span class="pl-0 pr-2">
                      <span class="lbl">Ilmiku sildid</span>
                      <button type="button" class="btn btn-light badge"
                              title="Lisa uus" data-toggle="modal"
                              th:data-target="${'#addLexemeTagDlg_' + lexeme.lexemeId}"
                              sec:authorize="#vars.lexeme.crudGrant">
                        <i class="action-icon fa fa-plus" aria-hidden="true"></i>
                      </button>
                      <span th:each="tag,tagIter : ${lexeme.tags}" class="hidden-buttons">
                        <span th:text="${tag}"></span>
                        <button type="button" class="btn badge badge-warning"
                                data-op-code="lexeme_tag"
                                th:data-id="${lexeme.lexemeId}"
                                th:data-value="${tag}"
                                data-toggle="delete-confirm"
                                data-placement="right"
                                sec:authorize="#vars.lexeme.crudGrant">
                          <i class="fa fa-remove" aria-hidden="true"></i>
                        </button>
                        <span th:unless="${tagIter.last}">,</span>
                      </span>
                    </span>
                  </div>
                  <th:block th:replace="syncomp :: definitions_data"></th:block>
                  <th:block th:replace="syncomp :: usages_data"></th:block>
                  <th:block th:replace="syncomp :: meaning_words_data(true)"></th:block>
                </div>
              </div>
            </div>
            <div class="col-4 border-left border-light h-100">
              <div class="navigate-panel mb-2 d-flex flex-column h-100">
                <div class="d-flex bg-light px-2 align-items-center">
                  <span th:text="#{syn.candidates.title}">Sünonüümide kandidaadid</span>
                  <div class="ml-auto d-flex flex-row align-items-center">
                    <span class="border-left py-2"></span>
                    <button type="button" class="btn btn-light px-2 rounded-0" data-toggle="modal" data-target="#selectSynCandidateLangDlg">
                      <span th:title="#{syn.choose.candidates.languages}" data-toggle="tooltip">
                        <i class="action-icon fa fa-globe" aria-hidden="true"></i>
                      </span>
                    </button>
                    <span class="border-left py-2"></span>
                    <button id="keyboardEditBtn" type="button" class="btn btn-light px-2 rounded-0" th:disabled="${markedSynWordId != null}">
                      <span th:title="#{syn.manual.mode}" data-toggle="tooltip">
                        <i class="action-icon fa fa-keyboard-o" aria-hidden="true"></i>
                      </span>
                    </button>
                    <span class="border-left py-2"></span>
                    <button type="button" class="btn btn-light px-2 rounded-0" data-toggle="modal" th:data-target="${'#addSynRelationDlg_' + wordId}">
                      <span th:title="#{syn.add.synonym}" data-toggle="tooltip">
                        <i class="action-icon fa fa-plus" aria-hidden="true"></i>
                      </span>
                    </button>
                  </div>
                </div>
                <div th:replace="syncomp :: syn_candidate_list"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div th:replace="syndialog :: #selectSynCandidateLangDlg"></div>
    <div th:replace="syndialog :: #selectSynMeaningWordLangDlg"></div>
    <div th:replace="syndialog :: add_word_note_dlg"></div>
    <div th:replace="syndialog :: add_syn_relation_dlg(${wordId}, ${details.word.lang}, ${details.wordRelationDetails.wordRelations})"></div>
    <div th:if="${!#lists.isEmpty(details.wordRelationDetails.wordRelations)}" th:each="synRelation : ${details.wordRelationDetails.wordRelations}">
      <div th:replace="syndialog :: syn_stats_dlg(${synRelation})"></div>
    </div>
    <script>
    	$('[data-toggle=deleteLexemeAndWordAndMeaning]').confirmation({
    		btnOkLabel : 'Jah',
    		btnCancelLabel : 'Ei',
    		title : 'Kinnita vaste ilmiku kustutamine',
    		onConfirm : deleteLexemeAndWordAndMeaning
    	});
        $('[data-toggle=delete-confirm]').confirmation({
          btnOkLabel : 'Jah',
          btnCancelLabel : 'Ei',
          title : 'Kinnita kustutamine',
          onConfirm : executeDelete
        });
    </script>
  </th:block>
  <div th:replace="common :: #waitDlg"></div>
  <div th:replace="common :: #alertDlg"></div>
  <div th:replace="common :: #confirmDlg"></div>
  <div th:replace="syndialog :: #synTutorialDlg"></div>
  <script th:inline="javascript">
	  initializeSynSearch();
  </script>
</body>
</html>
